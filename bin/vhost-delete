#!/usr/bin/env bash

if [[ ! "$1" ]]; then
    echo "Usage: vhost-delete <hostName>";
    exit 1;
fi

domain="$1";

# Disable the vhost.
sudo a2dissite "${domain}.local";

# Delete all files associated with this site.
sudo rm -rf /var/www/html/${domain};
sudo rm "/etc/apache2/sites-available/${domain}.local.conf";

# Clean the /etc/hosts
sudo sed -i "/${domain}/d" /etc/hosts;

# Drop the database.
mysql -u root -proot --execute "DROP DATABASE IF EXISTS ${domain%.*};";

# Restart Apache.
sudo systemctl restart apache2;
echo "The ${domain}.local vhost was deleted successfully.";
echo "Apache was restarted. All set.";